# Cloud/Responses Folder

## Purpose

This folder contains response files generated by the server in reply to requests from devices. The CloudWatcher generates responses after processing each request and organizes them by device/truck ID in subfolders.

## Folder Structure

```
Cloud/Responses/
├── truck-001/        # Device identifier folder
│   ├── resp-ping-2025-12-24T10-30-00.json
│   ├── resp-get_parts-2025-12-24T14-15-30.json
│   └── resp-update_inventory-2025-12-24T16-45-00.json
├── truck-002/
│   └── resp-echo_test-2025-12-24T15-00-00.json
└── device-mobile-001/
    └── resp-get_inventory-2025-12-24T17-30-00.json
```

## Response File Format

All responses follow this standard JSON schema:

```json
{
  "status": "success|error",
  "code": "string",
  "message": "string",
  "data": {
    "[response-specific fields]": "varies by request_type"
  },
  "timestamp": "2025-12-24T22:30:00Z",
  "build_signature": "20251224.223000"
}
```

### Field Definitions

- **status** (string): `"success"` or `"error"`
- **code** (string): Machine-readable result code (e.g., "processing_complete", "invalid_schema")
- **message** (string): Human-readable result description
- **data** (object): Request-type-specific response data (optional on errors)
- **timestamp** (ISO 8601): Server-generated timestamp when response created
- **build_signature** (string): Server build version (format: `YYYYMMdd.HHmmss`)

## Response Examples by Request Type

### Echo Test

**Request:**
```json
{
  "request_type": "echo_test",
  "payload": {
    "message": "Hello Server!"
  }
}
```

**Response:**
```json
{
  "status": "success",
  "code": "echo_complete",
  "message": "Echo test completed successfully",
  "data": {
    "echoed_message": "Hello Server!",
    "test_id": "test-12345"
  },
  "timestamp": "2025-12-24T22:30:00Z",
  "build_signature": "20251224.223000"
}
```

### Health Check (Ping)

**Request:**
```json
{
  "request_type": "ping",
  "payload": {}
}
```

**Response:**
```json
{
  "status": "success",
  "code": "ping_ok",
  "message": "Server is healthy",
  "data": {
    "server_version": "1.0.0",
    "uptime_minutes": 1440,
    "database_connected": true
  },
  "timestamp": "2025-12-24T22:30:00Z",
  "build_signature": "20251224.223000"
}
```

### Get Parts

**Request:**
```json
{
  "request_type": "get_parts",
  "payload": {
    "category": "fasteners"
  }
}
```

**Response:**
```json
{
  "status": "success",
  "code": "parts_retrieved",
  "message": "Found 156 parts in category 'fasteners'",
  "data": {
    "category": "fasteners",
    "count": 156,
    "parts": [
      {
        "id": "part-001",
        "name": "M8 Bolt",
        "brand": "BoltCo",
        "quantity_available": 250
      }
    ]
  },
  "timestamp": "2025-12-24T22:30:00Z",
  "build_signature": "20251224.223000"
}
```

### Update Inventory

**Request:**
```json
{
  "request_type": "update_inventory",
  "payload": {
    "truck_id": "truck-001",
    "inventory": [
      {
        "part_id": "part-001",
        "quantity_used": 5,
        "location": "warehouse-A"
      }
    ]
  }
}
```

**Response:**
```json
{
  "status": "success",
  "code": "inventory_updated",
  "message": "Inventory updated for truck-001: 1 item(s)",
  "data": {
    "truck_id": "truck-001",
    "items_updated": 1,
    "remaining_inventory": {
      "part-001": 245
    }
  },
  "timestamp": "2025-12-24T22:30:00Z",
  "build_signature": "20251224.223000"
}
```

### Get Inventory

**Request:**
```json
{
  "request_type": "get_inventory",
  "payload": {
    "truck_id": "truck-001"
  }
}
```

**Response:**
```json
{
  "status": "success",
  "code": "inventory_retrieved",
  "message": "Retrieved inventory for truck-001",
  "data": {
    "truck_id": "truck-001",
    "item_count": 45,
    "total_value": 12500,
    "items": [
      {
        "part_id": "part-001",
        "quantity": 250,
        "warehouse": "warehouse-A"
      }
    ]
  },
  "timestamp": "2025-12-24T22:30:00Z",
  "build_signature": "20251224.223000"
}
```

### Create Parts List

**Request:**
```json
{
  "request_type": "create_parts_list",
  "payload": {
    "name": "Emergency Repair Kit",
    "parts": [
      {
        "part_id": "part-001",
        "quantity": 10
      }
    ]
  }
}
```

**Response:**
```json
{
  "status": "success",
  "code": "parts_list_created",
  "message": "Parts list 'Emergency Repair Kit' created successfully",
  "data": {
    "list_id": "list-12345",
    "name": "Emergency Repair Kit",
    "item_count": 1,
    "created_at": "2025-12-24T22:30:00Z"
  },
  "timestamp": "2025-12-24T22:30:00Z",
  "build_signature": "20251224.223000"
}
```

## Error Responses

All errors follow the same format with `status: "error"`:

**Schema Validation Error:**
```json
{
  "status": "error",
  "code": "invalid_schema",
  "message": "Request missing required field: payload",
  "timestamp": "2025-12-24T22:30:00Z",
  "build_signature": "20251224.223000"
}
```

**Unknown Request Type:**
```json
{
  "status": "error",
  "code": "unknown_request_type",
  "message": "Request type 'fetch_orders' is not supported",
  "timestamp": "2025-12-24T22:30:00Z",
  "build_signature": "20251224.223000"
}
```

**Processing Error:**
```json
{
  "status": "error",
  "code": "processing_error",
  "message": "Database connection failed: timeout",
  "timestamp": "2025-12-24T22:30:00Z",
  "build_signature": "20251224.223000"
}
```

## File Naming Convention

Response files follow this pattern:

```
resp-[request_type]-[timestamp].json
```

**Examples:**
- `resp-ping-2025-12-24T10-30-00.json`
- `resp-get_parts-2025-12-24T14-15-30.json`
- `resp-update_inventory-2025-12-24T16-45-00.json`

The filename includes the request type and server-generated timestamp, making it easy to trace requests and responses.

## Device-Specific Subfolders

Responses are organized in subfolders by device/truck identifier:

```
Cloud/Responses/
├── truck-001/       # Truck 1 responses
├── truck-002/       # Truck 2 responses
├── device-mobile-001/   # Mobile device
├── device-mobile-002/   # Another mobile device
└── field-office-A/  # Field office requests
```

The client specifies which folder by including `client_id` in the request, or the request filename includes the device ID as a prefix.

## Performance Considerations

- **Response Size:** Keep data payloads under 5 MB
- **Timestamp Format:** Use ISO 8601 for all timestamps
- **Build Signature:** Updated on every server rebuild (matches CloudWatcher version)
- **Atomic Writes:** Responses are written atomically (temp file + move pattern)

## Cloud Storage Sync

This folder syncs to:
- **Primary:** SharePoint: `https://yourorg.sharepoint.com/sites/weirdtoo/Cloud/Responses`
- **Secondary:** Google Drive: `WeirdToo/Cloud/Responses`

Responses are available to clients as soon as they sync to cloud storage (typically <2 seconds).

## Cleanup & Archival

Old responses should be:
1. **Monthly:** Move responses >30 days old to `/Cloud/Archive/`
2. **Yearly:** Compress and store archived responses in cold storage
3. **Retention:** Keep audit trail for 7 years (compliance requirement)

See `/Cloud/Archive/README.md` for archival procedures.

## See Also

- `/Cloud/Requests/` - Where client requests are uploaded
- `/Cloud/SpecSheets/` - Parts specification documents
- `/Cloud/Archive/` - Historical responses (>30 days old)
- `server/CloudWatcher/Program.cs` - Response generation logic
